
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>SHPEC and Curl Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="c/unit-test-with-cmocka.html" />
    
    
    <link rel="prev" href="shpec-testing.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Preface</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Common Automation Concepts</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="common-automation-concepts/gherkin.html">
            
                <a href="common-automation-concepts/gherkin.html">
            
                    
                    Gherkin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="common-automation-concepts/assumption-styles.html">
            
                <a href="common-automation-concepts/assumption-styles.html">
            
                    
                    Assumption Styles
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Bash</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Bash.html">
            
                <a href="Bash.html">
            
                    
                    Bash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="shpec-testing.html">
            
                <a href="shpec-testing.html">
            
                    
                    SHPEC Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.3" data-path="shpec-and-curl.html">
            
                <a href="shpec-and-curl.html">
            
                    
                    SHPEC and Curl
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">C</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="c/unit-test-with-cmocka.html">
            
                <a href="c/unit-test-with-cmocka.html">
            
                    
                    Unit Test with CMOCKA
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Clojure</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="clojure/unit-test-with-clojure.html">
            
                <a href="clojure/unit-test-with-clojure.html">
            
                    
                    Unit Test with Clojure
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Go</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="go/test-with-go.html">
            
                <a href="go/test-with-go.html">
            
                    
                    Test with Go
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Java</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="java/intro-to-gradle.html">
            
                <a href="java/intro-to-gradle.html">
            
                    
                    Intro to Gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="java/intro-to-maven.html">
            
                <a href="java/intro-to-maven.html">
            
                    
                    Intro to Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="java/junit.html">
            
                <a href="java/junit.html">
            
                    
                    JUnit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="java/junit/cucumber-and-selenium.html">
            
                <a href="java/junit/cucumber-and-selenium.html">
            
                    
                    Cucumber & Selenium
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Javascript</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="javascript/first-nodejs-project.html">
            
                <a href="javascript/first-nodejs-project.html">
            
                    
                    First NodeJS Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="javascript/jasmine.html">
            
                <a href="javascript/jasmine.html">
            
                    
                    Jasmine
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.2.1" data-path="javascript/jasmine/jasmine-within-a-browser.html">
            
                <a href="javascript/jasmine/jasmine-within-a-browser.html">
            
                    
                    Jasmine within a Browser
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="javascript/cucumber-js.html">
            
                <a href="javascript/cucumber-js.html">
            
                    
                    Cucumber JS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.3.1" data-path="javascript/cucumber-js/cucumber-+-chai.html">
            
                <a href="javascript/cucumber-js/cucumber-+-chai.html">
            
                    
                    Cucumber + Chai
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3.2" data-path="javascript/cucumber-js/cucumberjs-+-selenium.html">
            
                <a href="javascript/cucumber-js/cucumberjs-+-selenium.html">
            
                    
                    CucumberJS + Selenium
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="javascript/frisbyjs.html">
            
                <a href="javascript/frisbyjs.html">
            
                    
                    FrisbyJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="javascript/galen-framework.html">
            
                <a href="javascript/galen-framework.html">
            
                    
                    Galen Framework
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">PHP</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="php/phpunit.html">
            
                <a href="php/phpunit.html">
            
                    
                    PHPUnit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1.1" data-path="php/phpunit/phpunit-+-selenium.html">
            
                <a href="php/phpunit/phpunit-+-selenium.html">
            
                    
                    PHPUnit + Selenium
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Python</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="python/lettuce.html">
            
                <a href="python/lettuce.html">
            
                    
                    Lettuce
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.1" data-path="python/lettuce/lettuce-+-selenium.html">
            
                <a href="python/lettuce/lettuce-+-selenium.html">
            
                    
                    Lettuce + Selenium
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="python/robot-framework.html">
            
                <a href="python/robot-framework.html">
            
                    
                    Robot Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="python/json-schema-validation.html">
            
                <a href="python/json-schema-validation.html">
            
                    
                    JSON Schema Validation
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Ruby</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="ruby/rspec.html">
            
                <a href="ruby/rspec.html">
            
                    
                    RSpec Unit Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="ruby/cucumber-+-ruby.html">
            
                <a href="ruby/cucumber-+-ruby.html">
            
                    
                    Cucumber + Ruby
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >SHPEC and Curl</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="shpec-and-curl-to-test-endpoints">SHPEC and Curl to test endpoints </h1>
<p>SHPEC makes it easy to wrap some Bash commands with some assertions. Curl is a data transfer tool that supports a wide variety of protocols. To test endpoints you will be transferring data from a HTTP or HTTPS resource.</p>
<p><strong>Ingredients</strong></p>
<ul>
<li>Bash</li>
<li>Curl</li>
<li>Date</li>
</ul>
<p><strong>Special Ingredients</strong></p>
<p>If you are running a Mac you will need to install coreutils to get the same GNU standard options for date. Recommended Way is to install using homebrew.</p>
<pre><code class="lang-bash">brew install coreutils
</code></pre>
<p><strong>Bake Time</strong></p>
<p>15 min.</p>
<p><strong>Instructions</strong></p>
<p>Start by creating a project structure.</p>
<pre><code class="lang-bash">mkdir shpec
mkdir -p shpec/matchers
</code></pre>
<p>Within the matchers directory create a file called<em>curl_matchers.sh</em>.</p>
<pre><code class="lang-bash"><span class="hljs-function"><span class="hljs-title">status_200</span></span>() {
  assert present <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;HTTP/1.1 200 OK&quot;</span>
}

<span class="hljs-function"><span class="hljs-title">content_type</span></span>() {
  assert present <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;Content-Type: <span class="hljs-variable">$2</span>;&quot;</span>
}
</code></pre>
<p>Notice that there are 2 matcher functions one for Status code and one for Content-Type.</p>
<p>The function_status_200()_takes in 1 argument $1 which will be the data returned back from Curl.</p>
<p>The function_content_type()_will take 2 arguments $1 and $2. $1 is the data that comes from Curl and $2 is the Content-Type that we are looking for.</p>
<p>Once you have your matchers create a new file called_first_curl_shpec.sh_and put in the following code.</p>
<pre><code class="lang-bash">describe <span class="hljs-string">&quot;SHPEC Curl Endpoint Test&quot;</span>
  start=<span class="hljs-string">&quot;<span class="hljs-variable">$(date +%s%3N)</span>&quot;</span>
  output=<span class="hljs-string">&quot;<span class="hljs-variable">$(curl -s -i &apos;http://www.testcookbook.com/lib/REST/test.json&apos;)</span>&quot;</span>
  end=<span class="hljs-string">&quot;<span class="hljs-variable">$(date +%s%3N)</span>&quot;</span>
  runtime=$((end-start))

  it <span class="hljs-string">&quot;has runtime less than 1 second&quot;</span>
    assert lt <span class="hljs-variable">$runtime</span> <span class="hljs-string">&quot;1000&quot;</span>
  end

  it <span class="hljs-string">&quot;returns a 200 status code&quot;</span>
    assert status_200 <span class="hljs-string">&quot;<span class="hljs-variable">$output</span>&quot;</span>
  end

  it <span class="hljs-string">&quot;returns an application/json contentType&quot;</span>
    assert content_<span class="hljs-built_in">type</span> <span class="hljs-string">&quot;<span class="hljs-variable">$output</span>&quot;</span> <span class="hljs-string">&quot;application/json&quot;</span>
  end
end
</code></pre>
<p>You will notice that immediately after the describe block there is a start, output, end and runtime. The start and end variables get the time before and after the Curl command. This will allow us to calculate the milliseconds that it took to run that specific command. The difference of these 2 values will be stored in runtime.</p>
<p>The other major variable that we are using is output. This is where we are storing the data returned from Curl.</p>
<p>Curl it self has a couple arguments that will help in producing the data we need to create some useful tests.</p>
<pre><code class="lang-bash">curl <span class="hljs-_">-s</span> -i some-url
</code></pre>
<p>The<em>-s_is used to suppress the progress bar from coming back in our data. The</em>-i_adds header information to the return value. This is where we can see things like Content-Type, Cookies, etc.</p>
<p>This will produce a result like the following and returns it within the output variable.</p>
<pre><code class="lang-bash">$ curl <span class="hljs-_">-s</span> -i <span class="hljs-string">&apos;http://www.testcookbook.com/lib/REST/test.json&apos;</span>
HTTP/1.1 200 OK
Server: GitHub.com
Date: Mon, 28 Nov 2016 15:40:54 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 25
Last-Modified: Mon, 28 Nov 2016 11:28:51 GMT
Access-Control-Allow-Origin: *
Expires: Mon, 28 Nov 2016 15:50:54 GMT
Cache-Control: max-age=600
Accept-Ranges: bytes
X-GitHub-Request-Id: 2FDE25D5:59A4:126984DF:583C5006

{
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span>
}
</code></pre>
<p>Once we have our data we can run asserts on the matchers that we created.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="shpec-testing.html" class="navigation navigation-prev " aria-label="Previous page: SHPEC Testing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="c/unit-test-with-cmocka.html" class="navigation navigation-next " aria-label="Next page: Unit Test with CMOCKA">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"SHPEC and Curl","level":"3.3","depth":1,"next":{"title":"Unit Test with CMOCKA","level":"4.1","depth":1,"path":"c/unit-test-with-cmocka.md","ref":"c/unit-test-with-cmocka.md","articles":[]},"previous":{"title":"SHPEC Testing","level":"3.2","depth":1,"path":"shpec-testing.md","ref":"shpec-testing.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"shpec-and-curl.md","mtime":"2017-05-08T13:20:51.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-08T13:26:52.228Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

