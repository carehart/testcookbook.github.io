<!DOCTYPE HTML>
<html>
<head>
    <title>Test Cookbook</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">

    <!-- CSS Reset -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/necolas/normalize.css/master/normalize.css">

    <!-- Milligram CSS minified -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">

    <link rel="stylesheet" href="/css/style.css">
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-85156207-1', 'auto');
        ga('send', 'pageview');
    </script>

    <script>
        function menutoggle() {
            var x = document.getElementById("sidemenu");
            var y = document.getElementById("content");
            if (x.style.display === 'none') {
                x.style.display = 'block';
                y.className = "column column-75";
            } else {
                x.style.display = 'none';
                y.className = "column column-100";
            }
        }

        function menu() {
            if (window.innerWidth >= 1024) {
                menutoggle();
            }
        }
    </script>
</head>
<body onload="menu()">
<div class="container">
    <div class="row">
        <div class="column column-80">
            <h1><a href="/">Test Cookbook</a></h1>
        </div>
        <div class="column">
            <button onclick="menutoggle()">Menu</button>
        </div>
    </div>
</div>

<hr/>
<div class="container">
    <div class="row">
        <div id="sidemenu" class="sidemenu column" style="display: none;">
            <ol>
    <li class="header">Preface</li>
    <ul>
        <li class="chapter active" data-level="1.1" data-path="./">
            <a href="/">Introduction</a>
        </li>
    </ul>
    <li class="header">Common Automation Concepts</li>
    <ul>
        <li>
            <a href="/book/common-automation-concepts/assumption-styles.html">
                Assumption Styles
            </a>
        </li>
        <li>
            <a href="/book/common-automation-concepts/gherkin.html">
                Gherkin
            </a>
        </li>
        <li>
            <a href="/book/common-automation-concepts/json-schema.html">
                JSON-Schema
            </a>
        </li>

    </ul>
    <li>Bash</li>
    <ul>
        <li>
            <a href="/book/bash/Bash.html">
                Bash
            </a>
        </li>
        <li>
            <a href="/book/bash/shpec-testing.html">
                SHPEC Testing
            </a>
        </li>
        <li>
            <a href="/book/bash/shpec-and-curl.html">
                SHPEC and Curl
            </a>
        </li>
    </ul>


    <li>C</li>
    <ul>
        <li>
            <a href="/book/c/unit-test-with-cmocka.html">
                Unit Test with CMOCKA
            </a>
        </li>
    </ul>

    <li>C++</li>
    <ul>
        <li>
            <a href="/book/cpp/setting-up-cmake-google-test.html">
                Setting up CMake for Google Test
            </a>
        </li>
        <li>
            <a href="/book/cpp/unit-test-with-google-test.html">
                Unit Test with Google Test
            </a>
        </li>
    </ul>

    <li>Clojure</li>
    <ul>
        <li>
            <a href="/book/clojure/unit-test-with-clojure.html">
                Unit Test with Clojure
            </a>
        </li>
    </ul>

    <li>Go</li>
    <ul>
        <li>
            <a href="/book/go/test-with-go.html">
                Test with Go
            </a>
        </li>
    </ul>
    <li>Java</li>
    <ul>
        <li>
            <a href="/book/java/intro-to-gradle.html">
                Intro to Gradle
            </a>
        </li>
        <li>
            <a href="/book/java/intro-to-maven.html">
                Intro to Maven
            </a>
        </li>
        <li>
            <a href="/book/java/junit.html">JUnit</a>
        </li>
        <li>
            <a href="/book/java/junit/cucumber-and-selenium.html">Cucumber & Selenium</a>
        </li>
    </ul>
    <li>Javascript</li>
    <ul>
        <li>
            <a href="/book/javascript/first-nodejs-project.html">First NodeJS Project</a>
        </li>
        <li>
            <a href="/book/javascript/jasmine.html">Jasmine</a>
            <ul>
                <li>
                    <a href="/book/javascript/jasmine/jasmine-within-a-browser.html">
                        Jasmine within a Browser
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <a href="/book/javascript/cucumber-js.html">
                Cucumber JS
            </a>
            <ul>
                <li>
                    <a href="/book/javascript/cucumber-js/cucumber-+-chai.html">
                        Cucumber + Chai
                    </a>
                </li>

                <li>
                    <a href="/book/javascript/cucumber-js/cucumberjs-+-selenium.html">
                        CucumberJS + Selenium
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <a href="/book/javascript/frisbyjs.html">
                FrisbyJS
            </a>
        </li>
        <li>
            <a href="/book/javascript/galen-framework.html">
                Galen Framework
            </a>
        </li>
        <li>
            <a href="/book/javascript/json-schema/tiny-validator.html">
                Tiny Validator v4
            </a>
        </li>

    </ul>
    <li>PHP</li>
    <ul>
        <li>
            <a href="/book/php/phpunit.html">
                PHPUnit
            </a>
        </li>
        <li>
            <a href="/book/php/phpunit/phpunit-+-selenium.html">
                PHPUnit + Selenium
            </a>
        </li>

    </ul>


    <li>Python</li>
    <ul>
        <li>
            <a href="/book/python/lettuce.html">
                Lettuce
            </a>
        </li>
        <li>
            <a href="/book/python/lettuce/lettuce-+-selenium.html">
                Lettuce + Selenium
            </a>
        </li>
        </li>
        <li>
            <a href="/book/python/robot-framework.html">
                Robot Framework
            </a>
        </li>
        <li>
            <a href="/book/python/json-schema-validation.html">
                JSON Schema Validation
            </a>
        </li>
    </ul>

    <li>Ruby</li>
    <ul>
        <li>
            <a href="/book/ruby/rspec.html">RSpec Unit Tests</a>
        </li>
        <li>
            <a href="/book/ruby/cucumber-+-ruby.html">Cucumber + Ruby</a>
        </li>
    </ul>
    <li>Rust</li>
    <ul>
        <li>
            <a href="/book/rust/unit-test-rust.html">Rust Unit Tests</a>
        </li>
    </ul>
</ol>

        </div>
        <div id="content" class="column column-100">
            <h1 id="shpec-and-curl-to-test-endpoints">SHPEC and Curl to test endpoints</h1>

<p>SHPEC makes it easy to wrap some Bash commands with some assertions. Curl is a data transfer tool that supports a wide variety of protocols. To test endpoints you will be transferring data from a HTTP or HTTPS resource.</p>

<p><strong>Ingredients</strong></p>

<ul>
  <li>Bash</li>
  <li>Curl</li>
  <li>Date</li>
</ul>

<p><strong>Special Ingredients</strong></p>

<p>If you are running a Mac you will need to install coreutils to get the same GNU standard options for date. Recommended Way is to install using homebrew.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>brew install coreutils
</code></pre>
</div>

<p><strong>Bake Time</strong></p>

<p>15 min.</p>

<p><strong>Instructions</strong></p>

<p>Start by creating a project structure.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mkdir shpec
mkdir -p shpec/matchers
</code></pre>
</div>

<p>Within the matchers directory create a file called_curl_matchers.sh_.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>status_200<span class="o">()</span> <span class="o">{</span>
  assert present <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="s2">"HTTP/1.1 200 OK"</span>
<span class="o">}</span>

content_type<span class="o">()</span> <span class="o">{</span>
  assert present <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="s2">"Content-Type: </span><span class="nv">$2</span><span class="s2">;"</span>
<span class="o">}</span>

</code></pre>
</div>

<p>Notice that there are 2 matcher functions one for Status code and one for Content-Type.</p>

<p>The function_status_200()_takes in 1 argument $1 which will be the data returned back from Curl.</p>

<p>The function_content_type()_will take 2 arguments $1 and $2. $1 is the data that comes from Curl and $2 is the Content-Type that we are looking for.</p>

<p>Once you have your matchers create a new file called_first_curl_shpec.sh_and put in the following code.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>describe <span class="s2">"SHPEC Curl Endpoint Test"</span>
  <span class="nv">start</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>date +%s%3N<span class="k">)</span><span class="s2">"</span>
  <span class="nv">output</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>curl -s -i <span class="s1">'http://www.testcookbook.com/lib/REST/test.json'</span><span class="k">)</span><span class="s2">"</span>
  <span class="nv">end</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>date +%s%3N<span class="k">)</span><span class="s2">"</span>
  <span class="nv">runtime</span><span class="o">=</span><span class="k">$((</span>end-start<span class="k">))</span>

  it <span class="s2">"has runtime less than 1 second"</span>
    assert lt <span class="nv">$runtime</span> <span class="s2">"1000"</span>
  end

  it <span class="s2">"returns a 200 status code"</span>
    assert status_200 <span class="s2">"</span><span class="nv">$output</span><span class="s2">"</span>
  end

  it <span class="s2">"returns an application/json contentType"</span>
    assert content_type <span class="s2">"</span><span class="nv">$output</span><span class="s2">"</span> <span class="s2">"application/json"</span>
  end
end

</code></pre>
</div>

<p>You will notice that immediately after the describe block there is a start, output, end and runtime. The start and end variables get the time before and after the Curl command. This will allow us to calculate the milliseconds that it took to run that specific command. The difference of these 2 values will be stored in runtime.</p>

<p>The other major variable that we are using is output. This is where we are storing the data returned from Curl.</p>

<p>Curl it self has a couple arguments that will help in producing the data we need to create some useful tests.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl -s -i some-url
</code></pre>
</div>

<p>The_-s_is used to suppress the progress bar from coming back in our data. The_-i_adds header information to the return value. This is where we can see things like Content-Type, Cookies, etc.</p>

<p>This will produce a result like the following and returns it within the output variable.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -s -i <span class="s1">'http://www.testcookbook.com/lib/REST/test.json'</span>
HTTP/1.1 200 OK
Server: GitHub.com
Date: Mon, 28 Nov 2016 15:40:54 GMT
Content-Type: application/json; <span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length: 25
Last-Modified: Mon, 28 Nov 2016 11:28:51 GMT
Access-Control-Allow-Origin: <span class="k">*</span>
Expires: Mon, 28 Nov 2016 15:50:54 GMT
Cache-Control: max-age<span class="o">=</span>600
Accept-Ranges: bytes
X-GitHub-Request-Id: 2FDE25D5:59A4:126984DF:583C5006

<span class="o">{</span>
  <span class="s2">"name"</span>: <span class="s2">"John Doe"</span>
<span class="o">}</span>

</code></pre>
</div>

<p>Once we have our data we can run asserts on the matchers that we created.</p>


        </div>
    </div>
</div>
</body>
</html>
