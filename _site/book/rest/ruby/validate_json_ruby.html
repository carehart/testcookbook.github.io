<!DOCTYPE html>
<html>
  <head>
    <title>Validating JSON with Ruby</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-language" content="en-us">
    <meta name="description" content="Simple how to validate JSON format with Ruby">
    <link rel="stylesheet" href="/lib/w3.css" />
    <link rel="stylesheet" href="/lib/style.css" />
    <link rel="stylesheet" href="/lib/zenburn.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85156207-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="w3-container w3-blue">
      <div class="titleHeader">
        <span class="w3-opennav w3-hide-large w3-hide-medium" onclick="w3_open()">
          <i class="fa fa-book" aria-hidden="true"></i>
        </span>
        <!--<span class="w3-opennav w3-hide-large w3-hide-medium" onclick="w3_open()">&#9776;</span>-->
        <a class="w3-btn w3-blue" href="/">
          <i class="fa fa-book w3-hide-small" aria-hidden="true"></i>
          Test Cookbook</a>
      </div>
    </div>
    <div class="w3-row">
      <div class="w3-col m4 l3 w3-green">
        <nav class="w3-sidebar w3-collapse" id="mySidenav">
          <a href="#" onclick="w3_close()" class="w3-btn w3-closenav w3-hide-large w3-hide-medium">Close &times;</a>
          <a href="/news.html">News</a>
<a href="/index.html">Introduction</a>
<!--<a href="" class="w3-pale-blue">Test Strategy - Todo</a>-->
<!--<a href="/book/table_of_contents.html">Book</a>-->
<span class="tc-menu-label">Testing Frameworks</span>
<div class="tc-indent w3-pale-green">
  <a href="/book/cucumber/about_cucumber.html">Cucumber</a>
  <a href="/book/test_frameworks/clojureTest/introToClojureTest.html">Clojure.Test</a>
  <a href="/book/test_frameworks/gauge/about_gauge.html">Gauge</a>
  <a href="/book/lettuce/about_lettuce.html">Lettuce</a>
  <a href="/book/test_frameworks/jasmine/about_jasmine.html">Jasmine</a>
  <a href="/book/test_frameworks/junit/about_junit.html">JUnit</a>
  <a href="/book/test_frameworks/phpunit/about_phpunit.html">PHPunit</a>
  <a href="/book/test_frameworks/robotframework/about_robot_framework.html">RobotFramework</a>
  <a href="/book/test_frameworks/rspec/about_rspec.html">RSpec</a>
</div>

<span class="tc-menu-label">Web Testing</span>
<div class="tc-indent w3-pale-green">
  <a href="/book/web_testing/java/cucumber_selenium.html">Java JVM Cucumber with Selenium Web Driver</a>
  <a href="/book/web_testing/javascript/cucumberjs-selenium.html">CucumberJS with Selenium Web Driver</a>
  <a href="/book/web_testing/javascript/jasmine_inline_html.html">Jasmine inline with HTML</a>
  <a href="https://github.com/testcookbook/php-phpunit-selenium">PHPunit with Selenium Web Driver</a>
  <a href="https://github.com/testcookbook/python-lettuce-selenium">Python Lettuce with Selenium</a>
  <a href="/book/web_testing/ruby/cucumber-ruby-watir-selenium.html">Ruby Cucumber with Watir and Selenium</a>
</div>

<span class="tc-menu-label">UX and UI Testing</span>
<div class="tc-indent w3-pale-green">
  <a href="/book/test_frameworks/galenframework/about_galen_framework.html">Galen Framework</a>
</div>

<span class="tc-menu-label">Rest API Testing</span>
<div class="tc-indent w3-pale-green">
  <a href="/book/rest/json_schema.html">JSON Schema</a>
  <a href="/book/rest/postman/postman.html">Intro to Postman</a>
  <a href="/book/rest/ruby/validate_json_ruby.html">Validating JSON with Ruby</a>
  <a href="/book/rest/python/validate_json_python.html">Validating JSON with Python</a>
  <a href="/book/rest/javascript/frisbyjs.html">REST with Frisby.js</a>
</div>

<span class="tc-menu-label">Basic Programming</span>
<div class="tc-indent w3-pale-green">
  <a href="/book/programming/java/gradle.html">Create Gradle Project</a>
  <a href="/book/programming/java/maven.html">Create Maven Project</a>
  <a href="/book/programming/javascript/npm_project.html">Create Node Project</a>
  <a href="/book/programming/wait-vs-sleep.html">Wait vs Sleep</a>
  <a href="/book/programming/gherkin.html">Gherkin</a>
</div>
<a href="/book/glossary/glossary.html">Glossary</a>

        </nav>
      </div>
      <div class="w3-col m8 l9">
        <div class="w3-container">
          <h1 id="validating-json-with-ruby">Validating JSON with Ruby</h1>

<p>There are a couple of different steps to determining whether a JSON is correct.
The first and most important is to determine if the JSON document that you
received has all the right commas, quotes, and format that it can be read.  To
do this we can create a simple function that will return true or false.  We will
read in the json and pass it to the JSON.parse function.  If it fails then the
rescue will fire up and allow the function to return false.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">def</span> <span class="nf">is_json_valid</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">JSON</span><span class="o">::</span><span class="no">ParserError</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">return</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<div class="w3-panel w3-pale-yellow w3-bottombar w3-topbar w3-border-green">
<i class="fa fa-lightbulb-o" aria-hidden="true"></i>
<!--<img alt="tip image" src="/lib/images/tip100.png" class="icon"/>-->

If you wanted a little more information on the error you could also add an
output to the console or custom log.
</div>

<p>The second important step in validating your JSON file is to compare it with a
JSON schema validation.  To do this we will start by importing a gem called
json-schema.</p>

<header class="cm1 w3-grey">
  <i class="fa fa-terminal" aria-hidden="true"></i>
<!--<img alt="tip image" src="/lib/images/cli.png" class="icon"/>-->

  Command Line
</header>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gem install json-schema
</code></pre>
</div>

<p>After the gem is installed you can start crafting your Ruby code.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'json-schema'</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="no">JSON</span><span class="o">::</span><span class="no">Validator</span><span class="p">.</span><span class="nf">validate!</span><span class="p">(</span><span class="n">schemaJson</span><span class="p">,</span> <span class="n">fileJson</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">true</span>
  <span class="k">rescue</span>
      <span class="no">JSON</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">ValidationError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="k">return</span> <span class="n">e</span><span class="p">.</span><span class="nf">message</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'someFile.json'</span><span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'someSchema.json'</span><span class="p">)</span>
<span class="n">validate</span><span class="p">(</span><span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
</code></pre>
</div>

<p>The validate function will either return true or the error message.  You could
also have it just return true or false.  It really depends on what kind of
information you would like to deal with.</p>

<p>You could also whip up a little RSpec magic to test your JSON as well.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'json-schema'</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="no">JSON</span><span class="o">::</span><span class="no">Validator</span><span class="p">.</span><span class="nf">validate!</span><span class="p">(</span><span class="n">schemaJson</span><span class="p">,</span> <span class="n">fileJson</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">true</span>
  <span class="k">rescue</span>
      <span class="no">JSON</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">ValidationError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="k">return</span> <span class="n">e</span><span class="p">.</span><span class="nf">message</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'someFile.json'</span><span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'someSchema.json'</span><span class="p">)</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Is JSON Valid"</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'should be a valid JSON'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">file</span><span class="p">))).</span><span class="nf">to</span> <span class="n">be_truthy</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

        </div>
      </div>
    </div>
    <script>
function w3_open() {
  document.getElementById("mySidenav").style.display = "block";
}
function w3_close() {
  document.getElementById("mySidenav").style.display = "none";
}
function myAccFunc(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-green";
    } else {
        x.className = x.className.replace(" w3-show", "");
        x.previousElementSibling.className =
        x.previousElementSibling.className.replace(" w3-green", "");
    }
}
    </script>
  <br /><br />
  <script id='pp-cfp' data-env='beta' data-token='0500ba510ce50288684513e5494598a81faed684cb49441bb716e20ac72703b5'>(function(d){var s=d.createElement('script'),c=d.createElement('link');s.src='https://beta.prodpad.com/static/js/prodpad-cfp.js';s.async=1;c.href='https://beta.prodpad.com/static/css/prodpad-cfp.css';c.rel='stylesheet';document.head.appendChild(c);document.head.appendChild(s);})(document);</script>
  </body>
</html>
